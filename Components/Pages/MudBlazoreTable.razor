@page "/mudblazore-table"
@inject TableDataGenerator DataGenerator

<PageTitle>MudBlazoreTable</PageTitle>

<h1>MudBlazoreTable</h1>

<p>Three-level hierarchical MudBlazor DataGrid with the same generated data.</p>

<MudBlazor.MudDataGrid T="TableRow"
                        Items="@Rows"
                        Dense="true"
                        Hover="true"
                        Striped="true"
                        Bordered="true">
    <Columns>
        <MudBlazor.HierarchyColumn T="TableRow" />
        <MudBlazor.PropertyColumn T="TableRow" TProperty="int" Property="x => x.Id" Title="ID" />
        <MudBlazor.PropertyColumn T="TableRow" TProperty="string" Property="x => x.Name" Title="Name" />
        <MudBlazor.PropertyColumn T="TableRow" TProperty="string" Property="x => x.Role" Title="Role" />
        <MudBlazor.TemplateColumn T="TableRow" Title="Active">
            <CellTemplate>
                @(context.Item.IsActive ? "Yes" : "No")
            </CellTemplate>
        </MudBlazor.TemplateColumn>
    </Columns>
    <ChildRowContent Context="parentContext">
        <div style="margin-left: 15px; padding: 8px 0;">
            <MudBlazor.MudText Typo="MudBlazor.Typo.subtitle1">Sub-rows for @parentContext.Item.Name</MudBlazor.MudText>
            <MudBlazor.MudDataGrid T="TableSubRow"
                                    Items="@GetSubRows(parentContext.Item.Id)"
                                    Dense="true"
                                    Hover="true"
                                    Bordered="true"
                                    Striped="true">
                <Columns>
                    <MudBlazor.HierarchyColumn T="TableSubRow" />
                    <MudBlazor.PropertyColumn T="TableSubRow" TProperty="int" Property="x => x.Id" Title="Sub ID" />
                    <MudBlazor.PropertyColumn T="TableSubRow" TProperty="string" Property="x => x.Component" Title="Component" />
                    <MudBlazor.PropertyColumn T="TableSubRow" TProperty="string" Property="x => x.Status" Title="Status" />
                    <MudBlazor.PropertyColumn T="TableSubRow" TProperty="string" Property="x => x.Owner" Title="Owner" />
                </Columns>
                <ChildRowContent Context="childContext">
                    <div style="margin-left: 15px; padding: 8px 0;">
                        <MudBlazor.MudText Typo="MudBlazor.Typo.subtitle2">Details for @childContext.Item.Component</MudBlazor.MudText>
                        <MudBlazor.MudDataGrid T="TableDetailRow"
                                                Items="@GetDetailRows(parentContext.Item.Id, childContext.Item.Id)"
                                                Dense="true"
                                                Hover="true"
                                                Bordered="true"
                                                Striped="true">
                            <Columns>
                                <MudBlazor.PropertyColumn T="TableDetailRow" TProperty="int" Property="x => x.Id" Title="Detail ID" />
                                <MudBlazor.PropertyColumn T="TableDetailRow" TProperty="string" Property="x => x.Metric" Title="Metric" />
                                <MudBlazor.PropertyColumn T="TableDetailRow" TProperty="string" Property="x => x.Value" Title="Value" />
                                <MudBlazor.PropertyColumn T="TableDetailRow" TProperty="string" Property="x => x.UpdatedBy" Title="Updated By" />
                            </Columns>
                        </MudBlazor.MudDataGrid>
                    </div>
                </ChildRowContent>
            </MudBlazor.MudDataGrid>
        </div>
    </ChildRowContent>
</MudBlazor.MudDataGrid>

@code {
    private IReadOnlyList<TableRow> Rows = [];

    protected override void OnInitialized()
    {
        Rows = DataGenerator.GetRows();
    }

    private IEnumerable<TableSubRow> GetSubRows(int parentId) =>
        DataGenerator.GetSubRows(parentId);

    private IEnumerable<TableDetailRow> GetDetailRows(int parentId, int childId) =>
        DataGenerator.GetDetailRows(parentId, childId);
}
